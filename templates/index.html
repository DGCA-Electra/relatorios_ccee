{% extends 'base.html' %}

{% block title %}Envio de RelatÃ³rios CCEE{% endblock %}

{% block page_title %}Envio de RelatÃ³rios CCEE{% endblock %}

{% block content %}

<div class="form-container">
  <form method="post">
    <div class="form-grid">
      <div class="form-group">
        <label>ğŸ“‹ Tipo de RelatÃ³rio:</label>
        <select name="tipo">
          {% for t in tipos %}
            <option value="{{ t }}" {% if form and form.tipo==t %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>ğŸ‘¤ Analista:</label>
        <select name="analista">
          {% for a in analistas %}
            <option value="{{ a }}" {% if form and form.analista==a %}selected{% endif %}>{{ a }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>ğŸ“… MÃªs:</label>
        <select name="mes">
          {% for m in meses %}
            <option value="{{ m }}" {% if form and form.mes==m %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>ğŸ—“ï¸ Ano:</label>
        <select name="ano">
          {% for y in anos %}
            <option value="{{ y }}" {% if form and form.ano==y %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div style="text-align: center;">
      <button type="submit" class="btn">ğŸš€ Processar RelatÃ³rios</button>
    </div>
  </form>
</div>

{% if results %}
  <div class="results-container">
    <h2>ğŸ“ˆ Resultado para {{ form.tipo }} - {{ form.mes }}/{{ form.ano }} - {{ form.analista }}</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ results|length }}</div>
        <div class="stat-label">Empresas Processadas</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ results|length }}</div>
        <div class="stat-label">E-mails Criados</div>
      </div>
    </div>
    <table class="results-table">
      <thead>
        <tr>
          <th>Empresa</th>
          <th>Data Aporte</th>
          <th>Valor</th>
          <th>E-mail</th>
          <th>Anexos</th>
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
        <tr>
          <td>{{ row.empresa }}</td>
          <td>{{ row.data }}</td>
          <td>{{ row.valor }}</td>
          <td class="email-cell">{{ row.email }}</td> 
          <td>{{ row.anexos_count }} arquivo(s)</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}
{% endblock %}